<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">

  <title>DuoCortex - Post</title>
  <meta name="description" content="View post on DuoCortex - Every Medico's Digital Campus">
  <meta name="keywords" content="medical students, medical education, duocortex">

  <!-- Favicons -->
  <link href="assets/img/logo-1.png" rel="icon" type="image/png">
  <link href="assets/img/logo-1.png" rel="apple-touch-icon">

  <!-- Dynamic OG tags will be set by Edge Function for crawlers -->
  <!-- These are fallback for direct visits -->
  <meta property="og:type" content="article" id="og-type">
  <meta property="og:title" content="DuoCortex Post" id="og-title">
  <meta property="og:description" content="View this post on DuoCortex" id="og-description">
  <meta property="og:image" content="https://duocortex.in/assets/img/logo-1.png" id="og-image">
  <meta property="og:url" content="https://duocortex.in" id="og-url">
  <meta property="og:site_name" content="DuoCortex">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="DuoCortex Post" id="twitter-title">
  <meta name="twitter:description" content="View this post on DuoCortex" id="twitter-description">
  <meta name="twitter:image" content="https://duocortex.in/assets/img/logo-1.png" id="twitter-image">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500,600,700&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */
    .header {
      background: rgba(255, 255, 255, 0.95);
      padding: 15px 20px;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      max-width: 600px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header img {
      width: 40px;
      height: 40px;
    }

    .header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      color: #5e35b1;
      margin: 0;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    /* Post Card */
    .post-card {
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
      max-width: 550px;
      width: 100%;
      overflow: hidden;
      animation: slideUp 0.5s ease-out;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* User Info */
    .user-info {
      padding: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      border-bottom: 1px solid #f0f0f0;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #667eea;
    }

    .user-avatar-placeholder {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 1.2rem;
    }

    .user-details h3 {
      font-size: 1rem;
      font-weight: 600;
      color: #333;
      margin: 0;
    }

    .user-details p {
      font-size: 0.85rem;
      color: #888;
      margin: 0;
    }

    .verified-badge {
      color: #667eea;
      margin-left: 5px;
    }

    /* Post Content */
    .post-content {
      padding: 20px;
    }

    .post-text {
      font-size: 0.95rem;
      line-height: 1.7;
      color: #333;
      white-space: pre-wrap;
      word-wrap: break-word;
    }

    /* Post Image */
    .post-image-container {
      width: 100%;
      max-height: 400px;
      overflow: hidden;
    }

    .post-image {
      width: 100%;
      height: auto;
      object-fit: cover;
    }

    /* Post Stats */
    .post-stats {
      padding: 15px 20px;
      display: flex;
      gap: 25px;
      border-top: 1px solid #f0f0f0;
      color: #666;
      font-size: 0.9rem;
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .stat-item i {
      font-size: 1.1rem;
    }

    .upvote { color: #667eea; }
    .downvote { color: #e53935; }
    .comment { color: #43a047; }

    /* CTA Section */
    .cta-section {
      padding: 20px;
      background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
      text-align: center;
    }

    .cta-text {
      font-size: 0.95rem;
      color: #5e35b1;
      margin-bottom: 15px;
    }

    .cta-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn-download {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 12px 25px;
      border-radius: 30px;
      text-decoration: none;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: transform 0.3s, box-shadow 0.3s;
    }

    .btn-download:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
      color: white;
    }

    .btn-download i {
      font-size: 1.2rem;
    }

    /* Loading State */
    .loading {
      padding: 60px 20px;
      text-align: center;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid #f3f3f3;
      border-top: 4px solid #667eea;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-text {
      color: #666;
      font-size: 1rem;
    }

    /* Error State */
    .error-state {
      padding: 60px 20px;
      text-align: center;
    }

    .error-icon {
      font-size: 4rem;
      color: #e53935;
      margin-bottom: 20px;
    }

    .error-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: #333;
      margin-bottom: 10px;
    }

    .error-text {
      color: #666;
      margin-bottom: 20px;
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 20px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 0.85rem;
    }

    .footer a {
      color: white;
      text-decoration: none;
    }

    /* Responsive */
    @media (max-width: 576px) {
      .post-card {
        border-radius: 0;
        margin: 0 -20px;
        max-width: none;
      }

      .main-content {
        padding: 20px 0;
        align-items: flex-start;
      }
    }
  </style>
</head>

<body>

  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <img src="assets/img/logo-1.png" alt="DuoCortex Logo">
      <h1>DuoCortex</h1>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <div class="post-card">
      <!-- Loading State -->
      <div id="loading-state" class="loading">
        <div class="spinner"></div>
        <p class="loading-text">Loading post...</p>
      </div>

      <!-- Error State (hidden by default) -->
      <div id="error-state" class="error-state" style="display: none;">
        <div class="error-icon">
          <i class="bi bi-exclamation-circle"></i>
        </div>
        <h2 class="error-title">Post Not Found</h2>
        <p class="error-text">This post may have been deleted or is not available.</p>
        <a href="https://duocortex.in" class="btn-download">
          <i class="bi bi-house"></i> Go to Homepage
        </a>
      </div>

      <!-- Post Content (hidden by default) -->
      <div id="post-container" style="display: none;">
        <!-- User Info -->
        <div class="user-info">
          <div id="user-avatar-container">
            <div class="user-avatar-placeholder" id="avatar-placeholder">U</div>
          </div>
          <div class="user-details">
            <h3 id="user-name">User Name <i class="bi bi-patch-check-fill verified-badge" id="verified-icon" style="display: none;"></i></h3>
            <p id="post-time">Just now</p>
          </div>
        </div>

        <!-- Post Text -->
        <div class="post-content">
          <p class="post-text" id="post-text"></p>
        </div>

        <!-- Post Image -->
        <div class="post-image-container" id="image-container" style="display: none;">
          <img src="" alt="Post Image" class="post-image" id="post-image">
        </div>

        <!-- Post Stats -->
        <div class="post-stats">
          <div class="stat-item upvote">
            <i class="bi bi-arrow-up-circle-fill"></i>
            <span id="upvote-count">0</span>
          </div>
          <div class="stat-item downvote">
            <i class="bi bi-arrow-down-circle-fill"></i>
            <span id="downvote-count">0</span>
          </div>
          <div class="stat-item comment">
            <i class="bi bi-chat-fill"></i>
            <span id="comment-count">0</span>
          </div>
        </div>

        <!-- CTA Section -->
        <div class="cta-section">
          <p class="cta-text">Join the medical community on DuoCortex!</p>
          <div class="cta-buttons">
            <a href="https://play.google.com/store/apps/details?id=com.duocortex" class="btn-download" target="_blank">
              <i class="bi bi-google-play"></i> Google Play
            </a>
            <a href="https://apps.apple.com/app/duocortex" class="btn-download" target="_blank">
              <i class="bi bi-apple"></i> App Store
            </a>
          </div>
        </div>
      </div>

    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p>&copy; 2024 <a href="https://duocortex.in">DuoCortex</a> - Every Medico's Digital Campus</p>
  </footer>

  <script>
    // Get post ID from URL
    function getPostId() {
      const path = window.location.pathname;
      // Handle both /post/ID and /post.html?id=ID formats
      if (path.includes('/post/')) {
        return path.split('/post/')[1];
      }
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('id');
    }

    // Format time ago
    function timeAgo(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const seconds = Math.floor((now - date) / 1000);

      if (seconds < 60) return 'Just now';
      if (seconds < 3600) return Math.floor(seconds / 60) + ' min ago';
      if (seconds < 86400) return Math.floor(seconds / 3600) + ' hours ago';
      if (seconds < 604800) return Math.floor(seconds / 86400) + ' days ago';
      return date.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' });
    }

    // Get initials from name
    function getInitials(name) {
      if (!name) return 'U';
      return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
    }

    // Truncate text
    function truncateText(text, maxLength) {
      if (!text) return '';
      if (text.length <= maxLength) return text;
      return text.substring(0, maxLength) + '...';
    }

    // Fetch and display post
    async function loadPost() {
      const postId = getPostId();

      if (!postId) {
        showError();
        return;
      }

      try {
        const response = await fetch(`https://api.duocortex.com/posts/post/${postId}`);

        if (!response.ok) {
          throw new Error('Post not found');
        }

        const post = await response.json();
        displayPost(post);
        updateMetaTags(post);

      } catch (error) {
        console.error('Error loading post:', error);
        showError();
      }
    }

    // Display post data
    function displayPost(post) {
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('post-container').style.display = 'block';

      // User info - using createdBy object
      const userName = post.createdBy?.name || 'Anonymous';
      const collegeName = post.createdBy?.collegeName || '';
      const yearOfStudy = post.createdBy?.yearOfStudy || '';

      document.getElementById('user-name').innerHTML = userName;
      document.getElementById('post-time').textContent = timeAgo(post.createdAt) + (collegeName ? ' â€¢ ' + collegeName : '');

      // Avatar - using createdBy.image.url
      const avatarContainer = document.getElementById('user-avatar-container');
      if (post.createdBy?.image?.url) {
        avatarContainer.innerHTML = `<img src="${post.createdBy.image.url}" alt="${userName}" class="user-avatar">`;
      } else {
        document.getElementById('avatar-placeholder').textContent = getInitials(userName);
      }

      // Post title and description
      const postText = document.getElementById('post-text');
      if (post.title) {
        postText.innerHTML = `<strong style="font-size: 1.1rem; display: block; margin-bottom: 10px;">${post.title}</strong>${post.description || ''}`;
      } else {
        postText.textContent = post.description || post.content || post.text || '';
      }

      // Post image - using image.url
      if (post.image?.url) {
        document.getElementById('image-container').style.display = 'block';
        document.getElementById('post-image').src = post.image.url;
      }

      // Stats - upvotes/downvotes are arrays
      document.getElementById('upvote-count').textContent = post.upvotes?.length || 0;
      document.getElementById('downvote-count').textContent = post.downvotes?.length || 0;
      document.getElementById('comment-count').textContent = post.comments?.length || post.commentsPagination?.totalCount || 0;
    }

    // Update meta tags dynamically (for browsers, not crawlers)
    function updateMetaTags(post) {
      const title = post.title || truncateText(post.description, 60) || 'DuoCortex Post';
      const description = truncateText(post.description || post.content || post.text, 160) || 'View this post on DuoCortex';
      const image = post.image?.url || 'https://duocortex.in/assets/img/logo-1.png';
      const url = window.location.href;

      document.title = title + ' | DuoCortex';

      // Update OG tags
      document.getElementById('og-title').content = title;
      document.getElementById('og-description').content = description;
      document.getElementById('og-image').content = image;
      document.getElementById('og-url').content = url;

      // Update Twitter tags
      document.getElementById('twitter-title').content = title;
      document.getElementById('twitter-description').content = description;
      document.getElementById('twitter-image').content = image;
    }

    // Show error state
    function showError() {
      document.getElementById('loading-state').style.display = 'none';
      document.getElementById('error-state').style.display = 'block';
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', loadPost);
  </script>

</body>

</html>
